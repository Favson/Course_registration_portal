<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up Form</title>
    <link rel="stylesheet" href="bootstrap-5.3.2-dist/bootstrap-5.3.2-dist/css/bootstrap.css">
    <link rel="stylesheet" href="index.css">
    <link rel="shortcut icon" href="Images/laulogo.png" type="image/x-icon">
</head>
<body>
    <div class="container">
        <p class="form-title" id="logo"></p>
        <h2>Create Account</h2>
        <form id="signUpForm">
            <input type="text" placeholder="Enter Full Name" required id="fullNameInpt" style="text-transform: uppercase;">
            <input type="email" placeholder="Email address" required style="margin-left: 20px;" id="emailInpt">
            <input type="number" placeholder="Phone number" required id="phoneNumberinpt" style="text-transform: uppercase;">
            <input type="number" placeholder="Matric Number" required style="margin-left: 20px;" id="matricInpt">
            <input type="text" placeholder="Level i.e 100H" required id="levelInpt" style="text-transform: uppercase;">
            <input type="text" placeholder="Department" required id="deptInpt" style="text-transform: uppercase; margin-left: 20px;">
            <input type="text" placeholder="Semester i.e Harmattan" required id="semesterInpt" style="text-transform: uppercase;">
            <input type="text" placeholder="Faculty i.e Computing and Informatics" required style="margin-left: 20px;text-transform: uppercase;" id="facultyInpt">
            <input type="text" placeholder="Dept. Abb. i.e CYB, CCS" required id="deptAbbInpt" style="text-transform: uppercase;">
            <input type="password" placeholder="Password" required style="margin-left: 20px;" id="passwordInpt"><br>
            <label for="gender">Gender:</label>
            <select name="genders" id="gender">
                <option value="Male" id="male">Male</option>
                <option value="Female" id="female">Female</option>
            </select>
            <button type="submit" class="btn submit">Submit</button>
        </form>
    </div>
    <script src="index.js" defer></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";

        const firebaseConfig = {    
          apiKey: "AIzaSyBzj-aMlFQ4Q0iY2F1WdFjpwPEtCzRmpr4",
          authDomain: "lautech-course-registration.firebaseapp.com",
          projectId: "lautech-course-registration",
          storageBucket: "lautech-course-registration.appspot.com",
          messagingSenderId: "765202115729",
          appId: "1:765202115729:web:d0da1c2777d3460f072330"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth();
        const db = getFirestore();

        document.getElementById('signUpForm').addEventListener('submit', function(event) {
            event.preventDefault();
            submit();
        });

        async function submit() {
            const fullName = document.getElementById('fullNameInpt').value;
            const email = document.getElementById('emailInpt').value;
            const phoneNumber = document.getElementById('phoneNumberinpt').value;
            const matric = document.getElementById('matricInpt').value;
            const level = document.getElementById('levelInpt').value;
            const dept = document.getElementById('deptInpt').value;
            const semester = document.getElementById('semesterInpt').value;
            const faculty = document.getElementById('facultyInpt').value;
            const deptAbb = document.getElementById('deptAbbInpt').value;
            const password = document.getElementById('passwordInpt').value;
            const gender = document.getElementById('gender').value;

            if (matric === "" || fullName === "" || email === "" || phoneNumber === "" || level === "" || dept === "" || password === "" || semester === "" || faculty === "" || deptAbb === "" || gender === "") {
                alert('Fill in all fields');
                console.error('Error: One or more fields are empty');
            } else {
                try {
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    const user = userCredential.user;

                    await setDoc(doc(db, "users", user.uid), {
                        fullName: fullName,
                        email: email,
                        phoneNumber: phoneNumber,
                        matric: matric,
                        level: level,
                        dept: dept,
                        semester: semester,
                        faculty: faculty,
                        deptAbb: deptAbb,
                        gender: gender
                    });

                    window.location.href = 'login.html';
                } catch (error) {
                    console.error('Error during account creation:', error.message);
                    alert('Error during account creation: ' + error.message);
                }
            }
        }
    </script>
</body>
</html>
