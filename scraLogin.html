<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Registration Portal</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="fontawesome-free-6.4.2-web/css/all.css">
    <link rel="shortcut icon" href="Images/laulogo.png" type="image/x-icon">
    <link rel="stylesheet" href="bootstrap-5.3.2-dist/bootstrap-5.3.2-dist/css/bootstrap.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body>
    <form class="form mx-auto col-md-12" id="form">
        <p class="form-title" id="logo"></p>
        <div class="input-container">
            <label for="matricNo"><b style="line-height:1px;">Matric Number</b></label>
            <input placeholder="Enter matric number" autofocus type="text" id="matricNo">
            <div class="spinner-border" id="loading" style="margin-left:115px; z-index:-1" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="text-danger" id="matricPass" style="font-size: smaller; font-weight:600;">The Matric Number Field is required</p>
            <p class="text-secondary" id="matricPass1" style="font-size: smaller; font-weight:600;">Incorrect credentials provided</p>
        </div>
        <div class="input-container">
            <label for="password"><b>Password</b></label>
            <input placeholder="Enter password" type="password" id="password">
            <span class="password-toggle-icon" id="eyeiconspan"><i class="fa-solid fa-eye pt-4" id="eyeIcon"></i></span>
            <p class="text-danger" id="matricPass2" style="font-size: smaller; font-weight:600;">The Password Field is required</p>
        </div>
        <button class="submit" type="button" id="button" onclick="login()">Login</button>
        <p><a href="reset.html" style="text-decoration: none; float:right; font-size:small;">Forgot Password?</a></p>
    </form>
    <footer class="text-center text-secondary pt-3" style="font-size: small;">Copyright Â© 2024 LAUTECH ICT. All rights reserved.</footer>
    <script src="script.js"></script>
    <script src="bootstrap-5.3.2-dist/bootstrap-5.3.2-dist/js/bootstrap.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";

        const firebaseConfig = {    
          apiKey: "AIzaSyBzj-aMlFQ4Q0iY2F1WdFjpwPEtCzRmpr4",
          authDomain: "lautech-course-registration.firebaseapp.com",
          projectId: "lautech-course-registration",
          storageBucket: "lautech-course-registration.appspot.com",
          messagingSenderId: "765202115729",
          appId: "1:765202115729:web:d0da1c2777d3460f072330"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.login = async function() {
            const matricNo = document.getElementById('matricNo').value;
            const password = document.getElementById('password').value;
            const loading = document.getElementById('loading');
            const matricPass = document.getElementById('matricPass');
            const matricPass1 = document.getElementById('matricPass1');
            const matricPass2 = document.getElementById('matricPass2');

            if (matricNo === "" || password === "") {
                if (matricNo === "") matricPass.style.display = 'block';
                if (password === "") matricPass2.style.display = 'block';
                return;
            }

            try {
                // Assuming email format is matricNo@student.lautech.edu.ng
                const email = `${matricNo}@student.lautech.edu.ng`;
                
                loading.style.display = "block";
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                const userDoc = await getDoc(doc(db, "users", user.uid));

                if (userDoc.exists()) {
                    loading.style.display = "none";
                    window.location.href = "home.html"; // Redirect to home page or relevant page
                } else {
                    throw new Error("User data not found in Firestore");
                }
            } catch (error) {
                console.error('Error during login:', error);
                loading.style.display = "none";
                matricPass1.style.display = 'block';
            }
        };
    </script>
</body>
</html>
